<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using the model · AGNI</title><meta name="title" content="Using the model · AGNI"/><meta property="og:title" content="Using the model · AGNI"/><meta property="twitter:title" content="Using the model · AGNI"/><meta name="description" content="Documentation for AGNI."/><meta property="og:description" content="Documentation for AGNI."/><meta property="twitter:description" content="Documentation for AGNI."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/style.css" rel="stylesheet" type="text/css"/><link href="../assets/logo.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="AGNI logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">AGNI</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../model/">Model description</a></li><li><a class="tocitem" href="../setup/">Getting started</a></li><li class="is-active"><a class="tocitem" href>Using the model</a><ul class="internal"><li><a class="tocitem" href="#Input-data-files"><span>Input data files</span></a></li><li><a class="tocitem" href="#Tutorials"><span>Tutorials</span></a></li><li><a class="tocitem" href="#General-execution"><span>General execution</span></a></li><li><a class="tocitem" href="#Solver-flags"><span>Solver flags</span></a></li><li><a class="tocitem" href="#Grids-of-models-parallelised-with-multiple-processes"><span>Grids of models parallelised with multiple processes</span></a></li><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Accessing-AGNI-from-Python"><span>Accessing AGNI from Python</span></a></li><li><a class="tocitem" href="#Line-by-line-radiative-transfer"><span>Line-by-line radiative transfer</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Example outputs</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../manual/">Software manual</a></li><li><a class="tocitem" href="../ecosystem/">Related codes</a></li><li><a class="tocitem" href="../thanks/">Acknowledgements</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Using the model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using the model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI/blob/main/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-the-model"><a class="docs-heading-anchor" href="#Using-the-model">Using the model</a><a id="Using-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-model" title="Permalink"></a></h1><p>Follow the <a href="../setup/#Getting-started">Getting started</a> instructions. Only read on once you have confirmed that the model runs on your machine. Otherwise, see the <a href="../troubleshooting/#Troubleshooting">Troubleshooting</a> guide.</p><h2 id="Input-data-files"><a class="docs-heading-anchor" href="#Input-data-files">Input data files</a><a id="Input-data-files-1"></a><a class="docs-heading-anchor-permalink" href="#Input-data-files" title="Permalink"></a></h2><p>The minimal input data required to run the model will have been downloaded automatically from Zenodo. If you require more data, such as additional stellar spectra or opacities, then these can also be easily obtained using the <code>get_data</code> script in the AGNI root directory. To see how to use this script, run it without arguments like so:</p><pre><code class="language-bash hljs">./src/get_data.sh</code></pre><p>Opacities are contained within &quot;spectral files&quot;. Use the table within <code>res/spectral_files/reference.pdf</code> to decide which spectral files are best for you.</p><p>For example, if you wanted to get the spectral file &quot;Honeyside48&quot; you would run:</p><pre><code class="language-bash hljs">./src/get_data.sh anyspec Honeyside 48</code></pre><h2 id="Tutorials"><a class="docs-heading-anchor" href="#Tutorials">Tutorials</a><a id="Tutorials-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials" title="Permalink"></a></h2><p>There are Jupyter notebooks containing tutorials in the <code>tutorials/</code> directory of the repository.</p><h2 id="General-execution"><a class="docs-heading-anchor" href="#General-execution">General execution</a><a id="General-execution-1"></a><a class="docs-heading-anchor-permalink" href="#General-execution" title="Permalink"></a></h2><p>The environment variable <code>RAD_DIR</code> must point to the SOCRATES installation directory. This is required for AGNI to find the SOCRATES libraries. The best way to do this is to add <code>RAD_DIR=path/to/socrates/folder/</code> to your shell rc file (e.g. <code>~/.bashrc</code>).</p><p>Then to use the model, simply run</p><pre><code class="language-bash hljs">./agni.jl [cfg]</code></pre><p>where <code>[cfg]</code> is the path to the desired configuration file. If <code>[cfg]</code> is not passed, then the default configuration file will be used.</p><p>You should see the following output:</p><pre><code class="language-log hljs">[ INFO  ] Using configuration &#39;Default&#39;
[ INFO  ] Setting-up a new atmosphere struct
[ INFO  ] Loading thermodyamic data
[ INFO  ] Inserting stellar spectrum and Rayleigh coefficients
[ INFO  ] Allocating atmosphere with composition:
[ INFO  ]       1 H2O     1.00e+00 (EOS_AQUA)
[ INFO  ] Setting T(p): dry, sat
[ INFO  ] Solving with &#39;none&#39;
[ INFO  ]     done
[ INFO  ] Total RT evalulations: 2
[ INFO  ] Writing results
[ INFO  ] Plotting results
[ INFO  ] Deallocating memory
[ INFO  ] Model runtime: 16.60 seconds</code></pre><p>The line following &quot;Allocating atmosphere with composition&quot; is a table of gases, their volume mixing ratios, and flags. In this case there is only one gas.</p><p>Potential flags for each species are:</p><ul><li><code>EOS_[XX]</code> - using the <code>[XX]</code> equation of state (e.g. ideal gas, AQUA)</li><li><code>NO_OPACITY</code> - no opacity data available, but can contribute to the thermodynamics</li><li><code>NO_THERMO</code> - no thermodynamic data available, so will be treated as a diatomic ideal gas</li><li><code>COND</code> - this gas is allowed to condense</li></ul><h2 id="Solver-flags"><a class="docs-heading-anchor" href="#Solver-flags">Solver flags</a><a id="Solver-flags-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-flags" title="Permalink"></a></h2><p>During each step of the iteration, AGNI will flag the solver status to indicate what was done and if any problems arose. These flags are separated by a hyphen (<code>-</code>).</p><p>Potential solver flags are:</p><ul><li><code>Cs</code> or <code>Cf</code> - chemistry and condensation schemes either (s)ucceeded or (f)ailed</li><li><code>Gg</code> - radiative transfer performed with double-grey scheme</li><li><code>M</code> or <code>Mr</code>  - convective fluxes are being modulated for stability</li><li><code>C2</code> or <code>C4</code> or <code>F2</code> or <code>F4</code>- a central or forward finite-difference scheme was used (at 2nd or 4th order)</li><li><code>Ls</code> - a linesearch method was applied</li><li><code>P</code> - step was forcibly extrapolated because the solver is not making good progress</li><li><code>U</code> - the atmosphere has become gravitationally unbound</li></ul><h2 id="Grids-of-models-parallelised-with-multiple-processes"><a class="docs-heading-anchor" href="#Grids-of-models-parallelised-with-multiple-processes">Grids of models parallelised with multiple processes</a><a id="Grids-of-models-parallelised-with-multiple-processes-1"></a><a class="docs-heading-anchor-permalink" href="#Grids-of-models-parallelised-with-multiple-processes" title="Permalink"></a></h2><p>The code is not explicitly parallelised. However, there is functionality to run a grid of models using by the script located at <code>misc/grid/worker.jl</code>. This script operates a single worker (of potentially many). All parameter configuration should be done by editing the <code>worker.jl</code> file directly.</p><p>For example, to run worker ID=1 and allocate two workers to the whole grid:</p><pre><code class="language-console hljs">julia --project=. misc/grid/worker.jl 1 2</code></pre><p>By allocating multiple workers and running them simultaneously using the manager script, which is located at <code>misc/grid/manager.jl</code>, we can parallelise the simulations. The number of workers is defined by the number of threads with which the manager script is run.</p><p>For example, run this manager script with four threads (and thus have four workers):</p><pre><code class="language-console hljs">julia -t4 misc/grid/manager.jl</code></pre><p>The manager script can also be executed on a HPC cluster by using the Slurm workload manager - assuming it is available on your server. You should then define the number of workers (and the allotted time) inside <code>slurm.sh</code> by setting <code>cpus-per-task=XX</code>.</p><p>For example:</p><pre><code class="language-console hljs">sbatch misc/grid/slurm.sh&quot;</code></pre><p>Once finished, combine the results of these workers by using the <code>consolidate.jl</code> script. This will generate <code>consolidated_*</code> files (2 CSV, 1 NetCDF) in the root folder of the grid.</p><p>For example, assuming that the grid root is located at the path <code>out/</code>:</p><pre><code class="language-console hljs">julia misc/grid/consolidate.jl out/</code></pre><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><p>AGNI configuration files are formatted using <a href="https://toml.io/en/">TOML</a>. There are examples in <code>res/config/</code>. The default configuration file contains comments explaining the purpose of each parameter, although some are explained in greater detail below. Take care to format the variables in the TOML file correctly. There are no &#39;default values&#39;. Not all parameters are required in all cases, but the model will return an error naming any parameters which are both necessary and absent.</p><p>The configuration files are broken up into four sections (or &quot;tables&quot;), each containing a number of parameters. These tables of parameters are described below.</p><h3 id="[planet]"><a class="docs-heading-anchor" href="#[planet]"><code>[planet]</code></a><a id="[planet]-1"></a><a class="docs-heading-anchor-permalink" href="#[planet]" title="Permalink"></a></h3><p>General properties of the planet.</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: right"><code>tmp_surf</code></td><td style="text-align: left">Temperature of the surface [kelvin].</td></tr><tr><td style="text-align: right"><code>instellation</code></td><td style="text-align: left">Stellar flux at planet&#39;s orbital distance [W m-2].</td></tr><tr><td style="text-align: right"><code>albedo_b</code></td><td style="text-align: left">A pseudo bond-albedo which downscales the stellar flux by 1-albedo_b.</td></tr><tr><td style="text-align: right"><code>s0_fact</code></td><td style="text-align: left">Stellar flux scale factor which accounts for planetary rotation (c.f. Cronin+13).</td></tr><tr><td style="text-align: right"><code>zenith_angle</code></td><td style="text-align: left">Characteristic zenith angle for incoming stellar radiation [degrees].</td></tr><tr><td style="text-align: right"><code>surface_material</code></td><td style="text-align: left">Surface material (can be &quot;greybody&quot; or path to data file in <code>res/</code>).</td></tr><tr><td style="text-align: right"><code>albedo_s</code></td><td style="text-align: left">Spectrally-grey surface albedo used when <code>material=greybody</code>. Optional otherwise.</td></tr><tr><td style="text-align: right"><code>radius</code></td><td style="text-align: left">Radius of the planet&#39;s surface [m].</td></tr><tr><td style="text-align: right"><code>gravity</code></td><td style="text-align: left">Gravitational acceleration at the surface [m s-2]. Incompatible with <code>mass</code> option.</td></tr><tr><td style="text-align: right"><code>mass</code></td><td style="text-align: left">Total mass of material below the atmosphere [kg]. Incompatible with <code>gravity</code> option.</td></tr><tr><td style="text-align: right"><code>skin_d</code></td><td style="text-align: left">Thickness of the conductive boundary layer [m]. Used when <code>solution_type=2</code>.</td></tr><tr><td style="text-align: right"><code>skin_k</code></td><td style="text-align: left">Conductivity of the conductive boundary layer [W m-1 K-1]. Used when <code>solution_type=2</code>.</td></tr><tr><td style="text-align: right"><code>tmp_magma</code></td><td style="text-align: left">Temperature of the topmost layer of the planet&#39;s mantle [K]. Used when <code>solution_type=2</code>.</td></tr><tr><td style="text-align: right"><code>flux_int</code></td><td style="text-align: left">Internal flux [W m-2] to be solved-for when <code>solution_type=3</code>.</td></tr><tr><td style="text-align: right"><code>roughness</code></td><td style="text-align: left">Surface roughness length scale [m]</td></tr><tr><td style="text-align: right"><code>wind_speed</code></td><td style="text-align: left">Effective wind speed for sensible heat transport [m s-1].</td></tr><tr><td style="text-align: right"><code>star_Teff</code></td><td style="text-align: left">Stellar photospheric temperature [K] used if <code>files.input_star==&quot;blackbody&quot;</code>.</td></tr></table><h3 id="[files]"><a class="docs-heading-anchor" href="#[files]"><code>[files]</code></a><a id="[files]-1"></a><a class="docs-heading-anchor-permalink" href="#[files]" title="Permalink"></a></h3><p>Input/output files and other paths.</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: right"><code>input_sf</code></td><td style="text-align: left">Path to the desired spectral file in <code>res/spectral_files/</code>. If &quot;greygas&quot;, uses double-grey RT scheme.</td></tr><tr><td style="text-align: right"><code>input_star</code></td><td style="text-align: left">Path to stellar spectrum. If blank, spectrum assumed to be inside spectral file. If &quot;blackbody&quot; must provide <code>planet.star_Teff</code>.</td></tr><tr><td style="text-align: right"><code>output_dir</code></td><td style="text-align: left">Path to the output directory.</td></tr><tr><td style="text-align: right"><code>rfm_parfile</code></td><td style="text-align: left">Path to .par linelist file, for running line-by-line calculations with the RFM.</td></tr></table><h3 id="[composition]"><a class="docs-heading-anchor" href="#[composition]"><code>[composition]</code></a><a id="[composition]-1"></a><a class="docs-heading-anchor-permalink" href="#[composition]" title="Permalink"></a></h3><p>Atmospheric composition and chemistry. There are three main ways to set the composition: partial pressures (<code>p_dict</code>), mixing ratios (<code>vmr_dict</code> or <code>vmr_file</code>), or by metallicities (<code>metallicities</code>).</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: right"><code>p_top</code></td><td style="text-align: left">Total top-of-atmosphere pressure [bar].</td></tr><tr><td style="text-align: right"><code>p_dict</code></td><td style="text-align: left">Dictionary of gas partial surface pressures [bar]. Summed to obtain <code>p_surf</code>.</td></tr><tr><td style="text-align: right"><code>p_surf</code></td><td style="text-align: left">Total surface pressure [bar]. Incompatible with <code>p_dict</code>.</td></tr><tr><td style="text-align: right"><code>vmr_dict</code></td><td style="text-align: left">Gas volume mixing ratios (=mole fractions) at the surface. Must also set <code>p_surf</code>.</td></tr><tr><td style="text-align: right"><code>vmr_file</code></td><td style="text-align: left">Path to a file containing mixing ratio profiles.  Must also set <code>p_surf</code>.</td></tr><tr><td style="text-align: right"><code>metallicities</code></td><td style="text-align: left">Dictionary of elemental <strong>mass</strong> abundance ratios relative to hydrogen. Must also set <code>p_surf</code>.</td></tr><tr><td style="text-align: right"><code>condensates</code></td><td style="text-align: left">List of volatiles which are allowed to condense. Incompatible with <code>chemistry &gt; 0</code>.</td></tr><tr><td style="text-align: right"><code>transparent</code></td><td style="text-align: left">Make the atmosphere transparent (see below). Replaces all of the above parameters in this table.</td></tr></table><h3 id="[execution]"><a class="docs-heading-anchor" href="#[execution]"><code>[execution]</code></a><a id="[execution]-1"></a><a class="docs-heading-anchor-permalink" href="#[execution]" title="Permalink"></a></h3><p>Parameters that tell the model what to do.</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: right"><code>clean_output</code></td><td style="text-align: left">Clean old files from the output folder at model startup (true/false).</td></tr><tr><td style="text-align: right"><code>verbosity</code></td><td style="text-align: left">Logging verbosity (0: quiet, 1: normal, 2: extra logging)</td></tr><tr><td style="text-align: right"><code>max_steps</code></td><td style="text-align: left">Maximum number of steps the solver should take before giving up (typically &lt;200).</td></tr><tr><td style="text-align: right"><code>max_runtime</code></td><td style="text-align: left">Maximum wall-clock runtime [s] before giving up.</td></tr><tr><td style="text-align: right"><code>num_levels</code></td><td style="text-align: left">Number of model levels. Typically ~50, and ideally less than 100.</td></tr><tr><td style="text-align: right"><code>converge_atol</code></td><td style="text-align: left">Convergence criterion, absolute amount of energy flux lost [W m-2].</td></tr><tr><td style="text-align: right"><code>converge_rtol</code></td><td style="text-align: left">Convergence criterion, relative amount of energy flux lost [dimensionless].</td></tr><tr><td style="text-align: right"><code>initial_state</code></td><td style="text-align: left">Ordered list of requests describing the initial state of the atmosphere (see below).</td></tr><tr><td style="text-align: right"><code>solution_type</code></td><td style="text-align: left">Solution type (see below).</td></tr><tr><td style="text-align: right"><code>solver</code></td><td style="text-align: left">Solver to use (see below).</td></tr><tr><td style="text-align: right"><code>dx_max</code></td><td style="text-align: left">Maximum step size [kelvin] allowed to be taken by the solver during each step.</td></tr><tr><td style="text-align: right"><code>linesearch</code></td><td style="text-align: left">Linesearch method to be used (0: None, 1: Golden section, 2: Backtracking)</td></tr><tr><td style="text-align: right"><code>easy_start</code></td><td style="text-align: left">Initially scale energy fluxes, to help with stability if the model is struggling.</td></tr><tr><td style="text-align: right"><code>grey_start</code></td><td style="text-align: left">Initially solve with double-grey RT scheme, to help with stability if the model is struggling.</td></tr><tr><td style="text-align: right"><code>perturb_all</code></td><td style="text-align: left">Perturb all rows of jacobian matrix at each solver iteration? True=stable, False=fast.</td></tr><tr><td style="text-align: right"><code>rfm_wn_min</code></td><td style="text-align: left">Line-by-line RFM radiative transfer, minimum wavenumber [cm-1]</td></tr><tr><td style="text-align: right"><code>rfm_wn_max</code></td><td style="text-align: left">Line-by-line RFM radiative transfer, maximum wavenumber [cm-1]</td></tr></table><h3 id="[physics]"><a class="docs-heading-anchor" href="#[physics]"><code>[physics]</code></a><a id="[physics]-1"></a><a class="docs-heading-anchor-permalink" href="#[physics]" title="Permalink"></a></h3><p>Parameters that describe how the model should treat the physics. | Parameter         | Description   | | ––––––––: | :–––––– | | <code>chemistry</code>  | Include 1D equilibrium chemistry in the atmosphere (true/false) | | <code>continua</code>  | Include collisional/continuum absorption in radiative transfer (true/false) | | <code>rayleigh</code>  | Include Rayleigh scattering in radiative transfer (true/false) | | <code>cloud</code>  | Include cloud scattering and opacity in radiative transfer (true/false) | | <code>overlap_method</code>  | Method for treating overlapping gas opacities within a given spectral band (see below) | | <code>grey_lw</code>         | Grey opacity [m2/kg] of longwave (thermal) radiation. Used when <code>input_sf=&quot;greygas&quot;</code> | | <code>grey_sw</code>         | Grey opacity [m2/kg] of shortwave (stellar) radiation. Used when <code>input_sf=&quot;greygas&quot;</code> | | <code>real_gas</code>  | Use real-gas equation(s) of state where possible (true/false) | | <code>thermo_funct</code>  | Use temperature-dependent thermodynamic properties (true/false) | | <code>sensible_heat</code>  | Include turbulent sensible heat transport at the surface (true/false) | | <code>advection</code>      | Include advective heat transport into each cell (true/false) | | <code>convection</code>  | Include vertical heat transport associated with convection (true/false) | | <code>convection_crit</code> | Criterion for convective stability. Options: (s)chwarzschild, (l)edoux | | <code>latent_heat</code>  | Include vertical heat transport from condensation and evaporation (true/false) | | <code>rainout</code>  | Enable condensation and evaporation of condensables aloft. Required for <code>latent_heat=true</code>. | | <code>oceans</code>  | Enable condensation and evaporation of condensables at the surface. |</p><h3 id="[plots]"><a class="docs-heading-anchor" href="#[plots]"><code>[plots]</code></a><a id="[plots]-1"></a><a class="docs-heading-anchor-permalink" href="#[plots]" title="Permalink"></a></h3><p>Configure plotting routines all of these should be <code>true</code> or <code>false</code>.</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: right"><code>at_runtime</code></td><td style="text-align: left">Make some plots at runtime?</td></tr><tr><td style="text-align: right"><code>temperature</code></td><td style="text-align: left">Plot temperature-pressure profile?</td></tr><tr><td style="text-align: right"><code>fluxes</code></td><td style="text-align: left">Plot energy flux profiles?</td></tr><tr><td style="text-align: right"><code>contribution</code></td><td style="text-align: left">Plot spectral contribution function?</td></tr><tr><td style="text-align: right"><code>emission</code></td><td style="text-align: left">Plot outgoing emission spectrum?</td></tr><tr><td style="text-align: right"><code>albedo</code></td><td style="text-align: left">Plot spectral albedo? This is the ratio of upward:downward SW fluxes</td></tr><tr><td style="text-align: right"><code>mixing_ratios</code></td><td style="text-align: left">Plot mixing ratio profiles?</td></tr><tr><td style="text-align: right"><code>height</code></td><td style="text-align: left">Plot radius-pressure profile?</td></tr><tr><td style="text-align: right"><code>animate</code></td><td style="text-align: left">Make an animation of the solver obtaining its solution?</td></tr><tr><td style="text-align: right"><code>cloud</code></td><td style="text-align: left">Plot water cloud mass fraction and area fraction profiles?</td></tr></table><h3 id="Details-on-specific-parameters"><a class="docs-heading-anchor" href="#Details-on-specific-parameters">Details on specific parameters</a><a id="Details-on-specific-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Details-on-specific-parameters" title="Permalink"></a></h3><ul><li><p><code>composition.transparent</code> configures the atmosphere to be transparent. This works by setting the pressure to be small, and turning off the gas opacity. With this provided, the rest of the parameters in <code>[configuration]</code> are redundant. With this enabled, make sure to use the appropriate solver in the <code>[execution]</code> table.</p></li><li><p><code>execution.solution_type</code> tells the model which state to solve for. The allowed values (integers) are...</p><ul><li>1 : zero flux divergence at fixed <code>tmp_surf</code></li><li>2 : zero flux divergence such that the conductive skin (CBL) conserves energy flux with fixed <code>tmp_magma</code></li><li>3 : the net flux (up minus down) at each layer is equal to <code>flux_int</code></li></ul><p>See the <a href="../model/#Model-description">Model description</a> page for an explanation of these solution types.</p></li><li><p><code>execution.solver</code> tells the model which solver to use. Allowed solvers are...</p><ul><li>[empty string] : no solving takes place, so the model just calculates fluxes using the initial state</li><li><code>newton</code> : the Newton-Raphson algorithm is used</li><li><code>gauss</code>  : the Gauss-Newton algorithm is used</li><li><code>levenberg</code> : the Levenberg–Marquardt algorithm is used</li><li><code>transparent</code> : solver to be used when <code>composition.transparent=true</code>.</li></ul></li><li><p><code>execution.initial_state</code> describes the initial temperature profile applied to the atmosphere. This is a list of strings which are applied in the given order, which allows the user to describe a specific state as required. The descriptors are listed below, some of which take a single argument that needs to immediately follow the descriptor in the list order.</p><ul><li><code>dry</code>              : integrate the dry adiabatic lapse rate from the surface upwards</li><li><code>str</code>,       <code>tmp</code> : apply an isothermal stratosphere at temperature <code>tmp</code></li><li><code>iso</code>,       <code>tmp</code> : set the whole atmosphere to be isothermal at temperature <code>tmp</code></li><li><code>csv</code>,       <code>pth</code> : set the temperature profile using the CSV file at the file path <code>pth</code></li><li><code>sat</code>,       <code>gas</code> : apply Clausius-Clapeyron saturation curve for the gas <code>gas</code></li><li><code>ncdf</code>,      <code>pth</code> : load profile from the NetCDF file located at <code>pth</code></li><li><code>loglin</code>,    <code>tmp</code> : log-linear profile between <code>tmp_surf</code> at the bottom and <code>tmp</code> at the top</li><li><code>ana</code>              : use the Guillot (<a href="https://arxiv.org/abs/1006.4702">2010</a>) analytical temperature solution</li></ul><p>For example, setting <code>initial_state = [&quot;dry&quot;, &quot;sat&quot;, &quot;H2O&quot;, &quot;str&quot;, &quot;180&quot;]</code> will set T(p) to follow the dry adiabat from the surface, the water condensation curve above that, and then to be isothermal at 180 K until the top of the model. Provide <code>tmp=&quot;Teq&quot;</code> to have AGNI automatically substitute-in the planet&#39;s radiative equilibrium temperature here.</p></li><li><p><code>physics.chemistry</code> enables a calculation of equilibrium thermochemistry in the atmosphere. This is handled externally by FastChem, so you must set the environment variable <code>FC_DIR</code> to point to the FastChem directory. More information on the chemistry is available on the <a href="../model/#Equilibrium-chemistry">Equilibrium chemistry</a> page.</p></li><li><p><code>physics.overlap_method</code> tells SOCRATES which algorithm to use to combine gas opacities. The spectral files contain k-tables for pure gases, and combining these coefficients can be done in several ways. See Amundsen+<a href="https://www.aanda.org/articles/aa/full_html/2017/02/aa29322-16/aa29322-16.html">2017</a> for a nice comparison of overlap methods. Allowed options are...</p><ul><li><code>&quot;ee&quot;</code>   : equivalent extinction (fastest)</li><li><code>&quot;rorr&quot;</code> : random overlap, with resorting and re-binning</li><li><code>&quot;ro&quot;</code>   : random overlap (most accurate, slowest)</li></ul></li></ul><h2 id="Accessing-AGNI-from-Python"><a class="docs-heading-anchor" href="#Accessing-AGNI-from-Python">Accessing AGNI from Python</a><a id="Accessing-AGNI-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-AGNI-from-Python" title="Permalink"></a></h2><p>It is possible to interact with AGNI from Python. This is best done with the <code>juliacall</code> package from <a href="https://github.com/JuliaPy/PythonCall.jl">PythonCall.jl</a>.</p><p>Coupling with Python is done via <code>juliacall</code> within the modular <a href="https://github.com/FormingWorlds/PROTEUS">PROTEUS framework</a>, which couples AGNI self-consistently to models of planetary interior evolution and volatile outgassing. You can see this implemented in <a href="https://github.com/FormingWorlds/PROTEUS/blob/main/src/proteus/atmos_clim/agni.py">agni.py</a> within the PROTEUS source code.</p><p>A skeleton example is given below:</p><pre><code class="language-python hljs"># Import juliacall
from juliacall import Main as jl

# Import AGNI
jl.seval(&quot;using Pkg&quot;)
jl.Pkg.activate(AGNI_ROOT_DIR)  # &lt;---- set AGNI_ROOT_DIR to your installation path
jl.seval(&quot;import AGNI&quot;)
jl.AGNI.setup_logging(&quot;out.log&quot;, 1)

# Setup atmosphere
atmos = jl.AGNI.atmosphere.Atmos_t()
jl.AGNI.atmosphere.setup_b(atmos, ...)   # &lt;--- complete function arguments as per docstring in `AGNI.atmosphere.setup!()`

# Allocate atmosphere
jl.AGNI.atmosphere.allocate_b(atmos, STAR_SPECTRUM_FILE)   # &lt;-- provide path to spectrum

# Solve T(p)
jl.AGNI.solver.solve_energy_b(atmos)

# Write results to a file
jl.AGNI.save.write_ncdf(atmos, &quot;out.nc&quot;)</code></pre><h2 id="Line-by-line-radiative-transfer"><a class="docs-heading-anchor" href="#Line-by-line-radiative-transfer">Line-by-line radiative transfer</a><a id="Line-by-line-radiative-transfer-1"></a><a class="docs-heading-anchor-permalink" href="#Line-by-line-radiative-transfer" title="Permalink"></a></h2><p>Performed using the <a href="https://eodg.atm.ox.ac.uk/RFM/">Reference Forward Model</a>. You must provide a HITRAN-formatted <code>.par</code> file, setting the path via <code>files.rfm_parfile</code>. This parfile can contain absorption from multiple species, and can be obtained from <a href="https://hitran.org/lbl/">hitran.org</a>. Alternatively, get the parfiles stored on Zenodo using: <code>./src/get_data.sh parfiles</code>.</p><p>Then, you must also set the variables <code>execution.rfm_wn_min</code> and <code>execution.rfm_wn_max</code>. These two parameters specify the wavenumber [cm-1] range over which to perform the LbL calculations. The wavenumber resolution is set to 1 cm-1.</p><p>Results are saved to the NetCDF file, alongside all the usual data, as <code>rfm_wn</code> and <code>rfm_fl</code> arrays.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../setup/">« Getting started</a><a class="docs-footer-nextpage" href="../examples/">Example outputs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 4 December 2025 11:16">Thursday 4 December 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
