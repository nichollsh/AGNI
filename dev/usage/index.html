<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using the model · AGNI</title><meta name="title" content="Using the model · AGNI"/><meta property="og:title" content="Using the model · AGNI"/><meta property="twitter:title" content="Using the model · AGNI"/><meta name="description" content="Documentation for AGNI."/><meta property="og:description" content="Documentation for AGNI."/><meta property="twitter:description" content="Documentation for AGNI."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AGNI</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../model/">Model description</a></li><li><a class="tocitem" href="../setup/">Getting started</a></li><li class="is-active"><a class="tocitem" href>Using the model</a><ul class="internal"><li><a class="tocitem" href="#Input-data-files"><span>Input data files</span></a></li><li><a class="tocitem" href="#Tutorials"><span>Tutorials</span></a></li><li><a class="tocitem" href="#General-execution"><span>General execution</span></a></li><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Accessing-AGNI-from-Python"><span>Accessing AGNI from Python</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Example outputs</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../manual/">Development</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Using the model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using the model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI/blob/main/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-the-model"><a class="docs-heading-anchor" href="#Using-the-model">Using the model</a><a id="Using-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-model" title="Permalink"></a></h1><p>First, follow the <a href="../setup/#Getting-started">Getting started</a> instructions. Only read on once you have confirmed that the code is working.</p><h2 id="Input-data-files"><a class="docs-heading-anchor" href="#Input-data-files">Input data files</a><a id="Input-data-files-1"></a><a class="docs-heading-anchor-permalink" href="#Input-data-files" title="Permalink"></a></h2><p>The minimal input data required to run the model will have been downloaded automatically. If you require more data, such as additional stellar spectra or opacities, then these can also be easily obtained using the <code>get_data</code> script in the AGNI root directory. To see how to use this script, run it without arguments like so:</p><pre><code class="language-bash hljs">./src/get_data.sh</code></pre><p>Opacities are contained within &quot;spectral files&quot;. Use the table within <code>res/spectral_files/reference.pdf</code> to decide which spectral files are best for you.</p><p>For example, if you wanted to get the spectral file &quot;Honeyside48&quot; you would run:</p><pre><code class="language-bash hljs">./src/get_data.sh anyspec Honeyside 48</code></pre><h2 id="Tutorials"><a class="docs-heading-anchor" href="#Tutorials">Tutorials</a><a id="Tutorials-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials" title="Permalink"></a></h2><p>There are Jupyter notebooks containing tutorials in the <code>tutorials/</code> directory of the repository.</p><h2 id="General-execution"><a class="docs-heading-anchor" href="#General-execution">General execution</a><a id="General-execution-1"></a><a class="docs-heading-anchor-permalink" href="#General-execution" title="Permalink"></a></h2><p>The environment variable <code>RAD_DIR</code> must point to the SOCRATES installation directory. This is required for AGNI to find the SOCRATES libraries. The best way to do this is to add <code>RAD_DIR=path/to/socrates/folder/</code> to your shell rc file (e.g. <code>~/.bashrc</code>).</p><p>Then to use the model, simply run</p><pre><code class="language-bash hljs">./agni.jl [cfg]</code></pre><p>where <code>[cfg]</code> is the path to the desired configuration file. If <code>[cfg]</code> is not passed, then the default configuration file will be used.</p><p>You should see the following output:</p><pre><code class="language-log hljs">[ INFO  ] Using configuration &#39;Default&#39;
[ INFO  ] Setting-up a new atmosphere struct
[ INFO  ] Loading thermodyamic data
[ INFO  ] Inserting stellar spectrum and Rayleigh coefficients
[ INFO  ] Allocating atmosphere with composition:
[ INFO  ]       1 H2O     1.00e+00 (EOS_AQUA)
[ INFO  ] Setting T(p): dry, sat
[ INFO  ] Solving with &#39;none&#39;
[ INFO  ]     done
[ INFO  ] Total RT evalulations: 2
[ INFO  ] Writing results
[ INFO  ] Plotting results
[ INFO  ] Deallocating memory
[ INFO  ] Model runtime: 16.60 seconds</code></pre><p>The line following &quot;Allocating atmosphere with composition&quot; is a table of gases, their volume mixing ratios, and flags. In this case there is only one gas.</p><p>Potential flags for each species are:</p><ul><li><code>EOS_[XX]</code> - using the <code>[XX]</code> equation of state (e.g. ideal gas, AQUA)</li><li><code>NO_OPACITY</code> - no opacity data available, but can contribute to the thermodynamics</li><li><code>NO_THERMO</code> - no thermodynamic data available, so will be treated as a diatomic ideal gas</li><li><code>COND</code> - this gas is allowed to condense</li></ul><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><p>AGNI configuration files are formatted using <a href="https://toml.io/en/">TOML</a>. There are examples in <code>res/config/</code>. The default configuration file contains comments explaining the purpose of each parameter, although some are explained in greater detail below. Take care to format the variables in the TOML file correctly. There are no &#39;default values&#39;. Not all parameters are required in all cases, but the model will return an error naming any parameters which are both necessary and absent.</p><p>The configuration files are broken up into four sections (or &quot;tables&quot;), each containing a number of parameters. These tables of parameters are described below.</p><h3 id="[planet]"><a class="docs-heading-anchor" href="#[planet]"><code>[planet]</code></a><a id="[planet]-1"></a><a class="docs-heading-anchor-permalink" href="#[planet]" title="Permalink"></a></h3><p>General properties of the planet. | Parameter          | Description   | | ––––––––– | ––––––- | | <code>tmp_surf</code> | Temperature of the surface [kelvin].  | | <code>instellation</code> | Stellar flux at planet&#39;s orbital distance [W m-2]. | | <code>albedo_b</code> | A pseudo bond-albedo which downscales the stellar flux by 1-albedo<em>b. | | `s0</em>fact         <code>| Stellar flux scale factor which accounts for planetary rotation (c.f. Cronin+13). | |</code>zenith<em>angle    <code>| Characteristic zenith angle for incoming stellar radiation [degrees]. | |</code>surface</em>material<code>| Surface material (can be &quot;greybody&quot; or path to data file in</code>res/<code>). | |</code>albedo<em>s        <code>| Spectrally-grey surface albedo used when</code>material=greybody<code>. Optional otherwise. | |</code>radius          <code>| Radius of the planet&#39;s surface [m]. | |</code>gravity         <code>| Gravitational acceleration at the surface [m s-2]. Incompatible with</code>mass<code>option. | |</code>mass            <code>| Total mass of material below the atmosphere [kg]. Incompatible with</code>gravity<code>option. | |</code>skin</em>d          <code>| Thickness of the conductive boundary layer [m]. Used when</code>solution<em>type=2<code>. | |</code>skin</em>k          <code>| Conductivity of the conductive boundary layer [W m-1 K-1]. Used when</code>solution<em>type=2<code>. | |</code>tmp</em>magma       <code>| Temperature of the topmost layer of the planet&#39;s mantle [K]. Used when</code>solution<em>type=2<code>. | |</code>flux</em>int        <code>| Internal flux [W m-2] to be solved-for when</code>solution<em>type=3<code>. | |</code>turb</em>coeff      <code>| Turbulent exchange coefficient for sensible heat transport. | |</code>wind_speed      ` | Effective wind speed for sensible heat transport [m s-1]. |</p><h3 id="[files]"><a class="docs-heading-anchor" href="#[files]"><code>[files]</code></a><a id="[files]-1"></a><a class="docs-heading-anchor-permalink" href="#[files]" title="Permalink"></a></h3><p>Input/output files and other paths. | Parameter          | Description   | | ––––––––– | ––––––- | | <code>input_sf</code>  | Path to the desired spectral file ending in <code>.sf</code>, in <code>res/spectral_files/</code>. | | <code>input_star</code>  | Path to stellar spectrum file. Spectrum assumed to be inside spectral file if this is left blank. | | <code>output_dir</code>  | Path to the output directory. |</p><h3 id="[composition]"><a class="docs-heading-anchor" href="#[composition]"><code>[composition]</code></a><a id="[composition]-1"></a><a class="docs-heading-anchor-permalink" href="#[composition]" title="Permalink"></a></h3><p>Atmospheric composition and chemistry. | Parameter         | Description   | | ––––––––- | ––––––- | | <code>p_top</code>  | Total top-of-atmosphere pressure [bar]. | | <code>p_dict</code>  | Dictionary of gas partial surface pressures [bar]. Summed to obtain <code>p_surf</code>. | | <code>p_surf</code>  | Total surface pressure [bar]. Incompatible with <code>p_dict</code>.| | <code>vmr_dict</code>  | Gas volume mixing ratios (=mole fractions) at the surface. Must be set alongside <code>p_surf</code>. | | <code>vmr_file</code>  | Path to a file containing mixing ratio profiles. Replaces <code>vmr_dict</code>. | | <code>chemistry</code>  | Type of chemistry to be used (see below). | | <code>condensates</code>  | List of volatiles which are allowed to condense. Incompatible with <code>chemistry &gt; 0</code>. |</p><h3 id="[execution]"><a class="docs-heading-anchor" href="#[execution]"><code>[execution]</code></a><a id="[execution]-1"></a><a class="docs-heading-anchor-permalink" href="#[execution]" title="Permalink"></a></h3><p>Parameters that tell the model what to do. | Parameter         | Description   | | ––––––––- | ––––––- | | <code>clean_output</code>  | Clean old files from the output folder at model startup (true/false). | | <code>verbosity</code>  | Logging verbosity (0: quiet, 1: normal, 2: extra logging) | | <code>max_steps</code>  | Maximum number of steps the solver should take before giving up (typically &lt;200). | | <code>max_runtime</code>  | Maximum wall-clock runtime [s] before giving up. | | <code>num_levels</code>  | Number of model levels. Typically ~50, and ideally less than 150.  | | <code>continua</code>  | Include collisional/continuum absorption in radiative transfer (true/false) | | <code>rayleigh</code>  | Include Rayleigh scattering in radiative transfer (true/false) | | <code>cloud</code>  | Include cloud scattering and opacity in radiative transfer (true/false) | | <code>overlap_method</code>  | Method for treating overlapping gas opacities within a given spectral band (see below) | | <code>real_gas</code>  | Use real-gas equation(s) of state where possible (true/false) | | <code>thermo_funct</code>  | Use temperature-dependent thermodynamic properties (true/false) | | <code>sensible_heat</code>  | Include sensible heat transport at the surface (true/false) | | <code>latent_heat</code>  | Include vertical heat transport from condensation and precipitation (true/false) | | <code>convection</code>  | Include vertical heat transport associated with convection (true/false) | | <code>rainout</code>  | Enable compositional rainout of condensable species. If disabled, phase change does not impact composition. | | <code>initial_state</code>  | Ordered list of requests describing the initial state of the atmosphere (see below). | | <code>solution_type</code>  | Solution type (see below). | | <code>solver</code>  | Solver to use (see below). | | <code>dx_max</code>  | Maximum step size [kelvin] allowed to be taken by the solver during each step. | | <code>linesearch</code>  | Linesearch method to be used (0: None, 1: Golden section, 2: Backtracking) | | <code>easy_start</code>  | Initially down-scale convective/condensation fluxes, if initial guess is poor/unknown. <strong>Enable if the model is struggling.</strong> | | <code>converge_atol</code>  | Convergence criterion, absolute amount of energy flux lost [W m-2]. | | <code>converge_rtol</code>  | Convergence criterion, relative amount of energy flux lost [dimensionless]. |</p><h3 id="[plots]"><a class="docs-heading-anchor" href="#[plots]"><code>[plots]</code></a><a id="[plots]-1"></a><a class="docs-heading-anchor-permalink" href="#[plots]" title="Permalink"></a></h3><p>Configure plotting routines all of these should be <code>true</code> or <code>false</code>. | Parameter         | Description   | | ––––––––- | ––––––- | | <code>at_runtime</code> | Make some plots at runtime? | | <code>temperature</code> | Plot temperature-pressure profile? | | <code>fluxes</code> | Plot energy flux profiles? | | <code>contribution</code> | Plot spectral contribution function? | | <code>emission</code> | Plot outgoing emission spectrum? | | <code>albedo</code> | Plot spectral albedo? This is the ratio of upward:downward SW fluxes | | <code>mixing_ratios</code> | Plot mixing ratio profiles? | | <code>height</code> | Plot radius-pressure profile? | | <code>animate</code> | Make an animation of the solver obtaining its solution? |</p><h3 id="Details-on-specific-parameters"><a class="docs-heading-anchor" href="#Details-on-specific-parameters">Details on specific parameters</a><a id="Details-on-specific-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Details-on-specific-parameters" title="Permalink"></a></h3><ul><li><p><code>execution.solution_type</code> tells the model which state to solve for. The allowed values (integers) are...</p><ul><li>1 : zero flux divergence at fixed <code>tmp_surf</code></li><li>2 : zero flux divergence such that the conductive skin (CBL) conserves energy flux with fixed <code>tmp_magma</code></li><li>3 : the net flux (up minus down) at each layer is equal to <code>flux_int</code></li></ul><p>See the <a href="../model/#Model-description">Model description</a> page for an explanation of these solution types.</p></li><li><p><code>execution.solver</code> tells the model which solver to use. Allowed solvers are...</p><ul><li>[empty string] : no solving takes place, so the model just calculates fluxes using the initial state</li><li><code>newton</code> : the Newton-Raphson algorithm is used</li><li><code>gauss</code>  : the Gauss-Newton algorithm is used</li><li><code>levenberg</code> : the Levenberg–Marquardt algorithm is used</li></ul></li><li><p><code>execution.initial_state</code> describes the initial temperature profile applied to the atmosphere. This is a list of strings which are applied in the given order, which allows the user to describe a specific state as required. The descriptors are listed below, some of which take a single argument that needs to immediately follow the descriptor in the list order.</p><ul><li><code>dry</code>              : integrate the dry adiabatic lapse rate from the surface upwards</li><li><code>str</code>,       <code>arg</code> : apply an isothermal stratosphere at <code>arg</code> kelvin</li><li><code>iso</code>,       <code>arg</code> : set the whole atmosphere to be isothermal at <code>arg</code> kelvin</li><li><code>csv</code>,       <code>arg</code> : set the temperature profile using the CSV file at the file path <code>arg</code></li><li><code>sat</code>,       <code>arg</code> : apply Clausius-Clapeyron saturation curve for the gas <code>arg</code></li><li><code>ncdf</code>,      <code>arg</code> : load profile from the NetCDF file located at <code>arg</code></li><li><code>loglin</code>,    <code>arg</code> : log-linear profile between <code>tmp_surf</code> at the bottom and <code>arg</code> at the top</li><li><code>ana</code>              : use the Guillot (<a href="https://arxiv.org/abs/1006.4702">2010</a>) analytical temperature solution</li></ul><p>For example, setting <code>initial_state = [&quot;dry&quot;, &quot;sat&quot;, &quot;H2O&quot;, &quot;str&quot;, &quot;180&quot;]</code> will set T(p) to follow the dry adiabat from the surface, the water condensation curve above that, and then to be isothermal at 180 K until the top of the model.</p></li><li><p><code>composition.chemistry</code> describes the type of chemistry to implement within the model. This is handled externally by FastChem, so you must set the environment variable <code>FC_DIR</code> to point to the FastChem directory. The allowed values (integers) are...</p><ul><li>0 : Disabled</li><li>1 : Equilibrium, gas phase only</li><li>2 : Equilibrium, with condensation (condensates retained)</li><li>3 : Equilibrium, with condensation (condensates rained out)</li></ul><p>More information on the chemistry is available on the <a href="../model/#Equilibrium-chemistry">Equilibrium chemistry</a> page</p></li><li><p><code>execution.overlap_method</code> tells SOCRATES which algorithm to use to combine gas opacities. The spectral files contain k-tables for pure gases, and combining these coefficients can be done in several ways. See Amundsen+<a href="https://www.aanda.org/articles/aa/full_html/2017/02/aa29322-16/aa29322-16.html">2017</a> for a nice comparison of overlap methods. Allowed options are...</p><ul><li><code>&quot;ee&quot;</code>   : equivalent extinction (fastest)</li><li><code>&quot;rorr&quot;</code> : random overlap, with resorting and re-binning</li><li><code>&quot;ro&quot;</code>   : random overlap (most accurate, slowest)</li></ul></li></ul><h2 id="Accessing-AGNI-from-Python"><a class="docs-heading-anchor" href="#Accessing-AGNI-from-Python">Accessing AGNI from Python</a><a id="Accessing-AGNI-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-AGNI-from-Python" title="Permalink"></a></h2><p>It is possible to interact with AGNI from Python. This is best done with the <code>juliacall</code> package from <a href="https://github.com/JuliaPy/PythonCall.jl">PythonCall.jl</a>.</p><p>Coupling with Python is done via <code>juliacall</code> within the modular <a href="https://github.com/FormingWorlds/PROTEUS">PROTEUS framework</a>, which couples AGNI self-consistently to models of planetary interior evolution and volatile outgassing. You can see this implemented in <a href="https://github.com/FormingWorlds/PROTEUS/blob/main/src/proteus/atmos_clim/agni.py">agni.py</a> within the PROTEUS source code.</p><p>A skeleton example is given below:</p><pre><code class="language-python hljs">
# Import juliacall
from juliacall import Main as jl

# Import AGNI
jl.seval(&quot;using Pkg&quot;)
jl.Pkg.activate(AGNI_ROOT_DIR)  # &lt;---- set AGNI_ROOT_DIR to your installation path
jl.seval(&quot;import AGNI&quot;)
jl.AGNI.setup_logging(&quot;out.log&quot;, 1)

# Setup atmosphere
atmos = jl.AGNI.atmosphere.Atmos_t()
jl.AGNI.atmosphere.setup_b(atmos, ...)   # &lt;--- complete function arguments as per docstring in `AGNI.atmosphere.setup!()`

# Allocate atmosphere
jl.AGNI.atmosphere.allocate_b(atmos, STAR_SPECTRUM_FILE)   # &lt;-- provide path to spectrum

# Solve T(p)
jl.AGNI.solver.solve_energy_b(atmos)

# Write results to a file
jl.AGNI.save.write_ncdf(atmos, &quot;out.nc&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../setup/">« Getting started</a><a class="docs-footer-nextpage" href="../examples/">Example outputs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Friday 25 April 2025 11:09">Friday 25 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
