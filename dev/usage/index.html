<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running the model · AGNI</title><meta name="title" content="Running the model · AGNI"/><meta property="og:title" content="Running the model · AGNI"/><meta property="twitter:title" content="Running the model · AGNI"/><meta name="description" content="Documentation for AGNI."/><meta property="og:description" content="Documentation for AGNI."/><meta property="twitter:description" content="Documentation for AGNI."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="AGNI logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">AGNI</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../model/">Model description</a></li><li><a class="tocitem" href="../setup/">Getting started</a></li><li class="is-active"><a class="tocitem" href>Running the model</a><ul class="internal"><li><a class="tocitem" href="#Input-data-files"><span>Input data files</span></a></li><li><a class="tocitem" href="#Tutorials"><span>Tutorials</span></a></li><li><a class="tocitem" href="#General-execution"><span>General execution</span></a></li><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Outputs"><span>Outputs</span></a></li><li><a class="tocitem" href="#Python"><span>Python</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Example outputs</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../manual/">Development</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Running the model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running the model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/nichollsh/AGNI/blob/main/docs/src/usage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-the-model"><a class="docs-heading-anchor" href="#Running-the-model">Running the model</a><a id="Running-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-model" title="Permalink"></a></h1><p>First, follow the <a href="../setup/#Getting-started">Getting started</a> instructions. Only read-on once you have confirmed that the code is working.</p><h2 id="Input-data-files"><a class="docs-heading-anchor" href="#Input-data-files">Input data files</a><a id="Input-data-files-1"></a><a class="docs-heading-anchor-permalink" href="#Input-data-files" title="Permalink"></a></h2><p>The minimal input data required to run the model will have been downloaded automatically. If you require more data, such as additional stellar spectra or opacities, then these can also be easily obtained using the <code>get_data</code> script in the AGNI root directory. To see how to use this script, run it without arguments like so:</p><pre><code class="language-bash hljs">./get_data.sh</code></pre><h2 id="Tutorials"><a class="docs-heading-anchor" href="#Tutorials">Tutorials</a><a id="Tutorials-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials" title="Permalink"></a></h2><p>There are Jupyter notebooks containing tutorials in the <code>tutorials/</code> directory of the repository.</p><h2 id="General-execution"><a class="docs-heading-anchor" href="#General-execution">General execution</a><a id="General-execution-1"></a><a class="docs-heading-anchor-permalink" href="#General-execution" title="Permalink"></a></h2><p>The environment variable <code>RAD_DIR</code> must point to the SOCRATES installation directory. This is required for AGNI to find the SOCRATES libraries, and can be done by running <code>source path/to/socrates/set_rad_env</code> in your terminal.</p><p>Then to use the model, simply run <code>./agni.jl [cfg]</code> where <code>[cfg]</code> is the path to the required configuration file. If <code>[cfg]</code> is not passed, then the default configuration will be used.</p><p>To calculate equilibrium chemistry self-consistently with the climate, FastChem is coupled to AGNI. For AGNI to find FastChem, the environment variable <code>FC_DIR</code> must point to the FastChem installation directory.</p><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><p>AGNI configuration files are formatted using <a href="https://toml.io/en/">TOML</a>. There are examples in <code>res/config/</code>. The default configuration file contains comments explaining the purpose of each parameter, although some are explained in greater detail below. Take care to format the variables in the TOML file correctly. There are no &#39;default values&#39;. Not all parameters are required in all cases, but the model will return an error naming any parameters which are both necessary and absent.</p><p>Broadly, the configuration files are broken up into four sections:</p><ul><li><code>[planet]</code> -  general characteristics of the planet</li><li><code>[files]</code> - input/output files and other paths</li><li><code>[composition]</code> - atmospheric composition and chemistry</li><li><code>[execution]</code> - what the model should do</li><li><code>[plots]</code> - which plots should be produced</li></ul><p>Some parameters:</p><ul><li><p><code>files.input_sf</code> is the file path to the &quot;spectral file&quot; containing opacity data. Several spectral files are packged with AGNI, but you can find more online via the <a href="https://osf.io/vehxg/">Open Science Framework</a>.</p></li><li><p><code>execution.solution_type</code> tells the model which state to solve for. The allowed values (integers) are...</p><ul><li>1 : zero flux divergence at fixed <code>tmp_surf</code></li><li>2 : zero flux divergence, with <code>tmp_surf</code> set such that the conductive skin (CBL) conserves energy flux</li><li>3 : the net upward flux at each layer is equal to <code>flux_int = sigma * tmp_int^4</code></li></ul></li><li><p><code>execution.solvers</code> tells the model which solvers to use. This is a list of strings, so multiple solvers can be applied sequentially. An empty string is always appended to the end of this list. Allowed solvers are...</p><ul><li>[empty string] : no solving takes place, so the model just calculates fluxes using the initial state</li><li><code>newton</code> : the Newton-Raphson algorithm is used</li><li><code>gauss</code>  : the Gauss-Newton algorithm is used</li><li><code>levenberg</code> : the Levenberg–Marquardt algorithm is used</li></ul></li><li><p><code>execution.initial_state</code> describes the initial temperature profile applied to the atmosphere. This is a list of strings which are applied in the given order, which allows the user to describe a specific state as required. The descriptors are listed below, some of which take a single argument that needs to immediately follow the descriptor in the list order.</p><ul><li><code>dry</code>              : integrate the dry adiabatic lapse rate from the surface upwards</li><li><code>str</code>,       <code>arg</code> : apply an isothermal stratosphere at <code>arg</code> kelvin</li><li><code>iso</code>,       <code>arg</code> : set the whole atmosphere to be isothermal at <code>arg</code> kelvin</li><li><code>csv</code>,       <code>arg</code> : set the temperature profile using the CSV file at the file path <code>arg</code></li><li><code>sat</code>,       <code>arg</code> : apply Clausius-Clapeyron saturation curve for the gas <code>arg</code></li><li><code>ncdf</code>,      <code>arg</code> : load profile from the NetCDF file located at <code>arg</code></li><li><code>loglin</code>,    <code>arg</code> : log-linear profile between <code>tmp_surf</code> at the bottom and <code>arg</code> at the top</li></ul><p>For example, setting <code>initial_state = [&quot;dry&quot;, &quot;sat&quot;, &quot;H2O&quot;, &quot;str&quot;, &quot;180&quot;]</code> will set T(p) to follow the dry adiabat from the surface, the water condensation curve above that, and then to be isothermal at 180 K until the top of the model.</p></li><li><p><code>composition.chem_type</code> describes the type of chemistry to implement within the model. This is handled externally by FastChem, so you must set the environment variable <code>FC_DIR</code> to point to the FastChem directory. The allowed values (integers) are...</p><ul><li>0 : Disabled</li><li>1 : Equilibrium, gas phase only</li><li>2 : Equilibrium, with condensation (condensates retained)</li><li>3 : Equilibrium, with condensation (condensates rained out)</li></ul></li></ul><h2 id="Outputs"><a class="docs-heading-anchor" href="#Outputs">Outputs</a><a id="Outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Outputs" title="Permalink"></a></h2><p>Results are optionally plotted and animated, and data will be saved as NetCDF or CSV files.</p><h2 id="Python"><a class="docs-heading-anchor" href="#Python">Python</a><a id="Python-1"></a><a class="docs-heading-anchor-permalink" href="#Python" title="Permalink"></a></h2><p>It is possible to interact with the model using Python. This is best done with the <code>juliacall</code> package from <a href="https://github.com/JuliaPy/PythonCall.jl">PythonCall.jl</a>, and is implemented this way in the <a href="https://github.com/FormingWorlds/PROTEUS">PROTEUS framework</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../setup/">« Getting started</a><a class="docs-footer-nextpage" href="../examples/">Example outputs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 13 September 2024 13:31">Friday 13 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
